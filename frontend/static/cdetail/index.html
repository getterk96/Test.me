<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Test.Me</title>
        <script src="https://unpkg.com/vue"></script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script src="https://unpkg.com/current-device/umd/current-device.min.js"></script>
        <script src="../js/uni.js"></script>
        <link type="text/css" rel="stylesheet" href="../css/uni.css" />
        <link type="text/css" rel="stylesheet" href="../css/cdetail.css" />
    </head>
    <body>
        <div id="header">
            <div id="header-content">
                <div id="header-greeting">{{ greeting }}</div>
                <div id="header-title">{{ title }}</div>
                <nav><ul>
                    <li v-for='link in link_list'>
                        <a :href='link.link' @click='link.action'>{{ link.alias }}</a>
                    </li>
                </ul></nav>
            </div>
        </div>
        <nav id="side-nav">
            <ul>
                <li v-for="item in list">
                    <label :class="['choice', item == choice ? 'chosen' : 'unchosen']" @click='select(item)'>{{ item }}</label>
                </li>
            </ul>
        </nav>
        <div id="body">
            <template v-if="!is_guest">
                <template v-if="is_organizer">
                    <template v-if="page == '比赛信息'">
                        <div :class="['session']">
                            <button :class="['s-title', show_basic_info ? '' :  'collapse']" @click="switch_basic_info"><span :class="['title']">比赛基本信息</span></button>
                            <article :class="['s-body']" v-if="show_basic_info">
                                <ul :class="['form']">
                                    <li v-for='item in contest.attr'>
                                        <div :class="['label']">{{ item.alias }}</div>
                                        <template v-if="item.type == 'text'">
                                            <input v-if="item.editable" v-model="item.content" :class="['input', 'long']" />
                                            <input v-else disabled v-model="item.content" :class="['input', 'long']" />
                                        </template>
                                        <template v-else-if="item.type == 'ltext'">
                                            <textarea v-if="item.editable" v-model="item.content" :class="['input', 'long']" rows='5'></textarea>
                                            <textarea v-else disabled v-model="item.content" :class="['input', 'long']" rows='5'></textarea>
                                        </template>
                                        <template v-else-if="item.type == 'datetime'">
                                            <div v-if="item.editable">
                                                <input :class="['input', 'mid']" type="date" v-model="item.content.sd" />
                                                <input  v-model="item.content.sh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                <input  v-model="item.content.sm" :class="['input', 'short']" type="number" min="0" max="59" />-
                                                <input :class="['input', 'mid']" type="date" v-model="item.content.ed" />
                                                <input  v-model="item.content.eh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                <input  v-model="item.content.em" :class="['input', 'short']" type="number" min="0" max="59"/>
                                            </div>
                                            <div v-else>
                                                <input disabled :class="['input', 'mid']" type="date" v-model="item.content.sd" />
                                                <input disabled  v-model="item.content.sh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                <input disabled  v-model="item.content.sm" :class="['input', 'short']" type="number" min="0" max="59" />-
                                                <input disabled :class="['input', 'mid']" type="date" v-model="item.content.ed" />
                                                <input disabled  v-model="item.content.eh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                <input disabled  v-model="item.content.em" :class="['input', 'short']" type="number" min="0" max="59"/>
                                            </div>
                                        </template>
                                        <template v-else-if="item.type == 'number'">
                                            <input v-if="item.editable" v-model="item.content" :class="['input']" type="number" />
                                            <input v-else disabled v-model="item.content" :class="['input']" type="number" />
                                        </template>
                                        <template v-else-if="item.type == 'progress'">
                                            <progress :max="contest.getAttr(item.content.base)" :value="item.content.value" :class="['progressbar']"></progress>
                                            <span>{{ item.content.value + "/" + contest.getAttr(item.content.base) }}</span>
                                        </template>
                                        <template v-else-if="item.type == 'file'">
                                            <label :class="['fileuploader']">
                                                <input type="file" @change="c_file_change" required/>
                                            </label>
                                            {{ item.content }}
                                        </template>
                                    </li>
                                </ul>
                            </article>
                        </div>
                            <div :class="['session']">
                                <button :class="['s-title', show_period_info ? '' : 'collapse']" @click="switch_period_info"><span :class="['title']">阶段信息</span></button>
                                <article :class="['s-body']" v-if="show_period_info">
                                    <ul :class="['form']" v-for="p in contest.period">
                                        <li v-for='item in p.attr'>
                                            <div :class="['label']">{{ item.alias }}</div>
                                            <template v-if="item.type == 'text'">
                                                <input v-if="item.editable" v-model="item.content" :class="['input', 'long']" />
                                                <input v-else disabled v-model="item.content" :class="['input', 'long']" />
                                            </template>
                                            <template v-else-if="item.type == 'ltext'">
                                                <textarea v-if="item.editable" v-model="item.content" :class="['input', 'long']" rows='5'></textarea>
                                                <textarea v-else disabled v-model="item.content" :class="['input', 'long']" rows='5'></textarea>
                                            </template>
                                            <template v-else-if="item.type == 'datetime'">
                                                <div v-if="item.editable">
                                                    <input :class="['input', 'mid']" type="date" v-model="item.content.sd" />
                                                    <input  v-model="item.content.sh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                    <input  v-model="item.content.sm" :class="['input', 'short']" type="number" min="0" max="59" />-
                                                    <input :class="['input', 'mid']" type="date" v-model="item.content.ed" />
                                                    <input  v-model="item.content.eh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                    <input  v-model="item.content.em" :class="['input', 'short']" type="number" min="0" max="59"/>
                                                </div>
                                                <div v-else>
                                                    <input disabled :class="['input', 'mid']" type="date" v-model="item.content.sd" />
                                                    <input disabled  v-model="item.content.sh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                    <input disabled  v-model="item.content.sm" :class="['input', 'short']" type="number" min="0" max="59" />-
                                                    <input disabled :class="['input', 'mid']" type="date" v-model="item.content.ed" />
                                                    <input disabled  v-model="item.content.eh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                    <input disabled  v-model="item.content.em" :class="['input', 'short']" type="number" min="0" max="59"/>
                                                </div>
                                            </template>
                                            <template v-else-if="item.type == 'number'">
                                                <input v-if="item.editable" v-model="item.content" :class="['input']" type="number" />
                                                <input v-else disabled v-model="item.content" :class="['input']" type="number" />
                                            </template>
                                            <template v-else-if="item.type == 'progress'">
                                                <progress :max="contest.getAttr(item.content.base)" :value="item.content.value" :class="['progressbar']"></progress>
                                                <span>{{ item.content.value + "/" + contest.getAttr(item.content.base) }}</span>
                                            </template>
                                            <template v-else-if="item.type == 'file'">
                                                <label :class="['fileuploader']">
                                                    <input type="file" :id="'p' + p.lid" @change="p_file_change" required/>
                                                </label>
                                                {{ item.content }}
                                            </template>
                                        </li>
                                        <template v-for="q in p.question">
                                            <li>
                                                <div :class="['label', 'bold']">{{ '题目' + (parseInt(q.lid) + 1).toString() }}</div>
                                            </li>
                                            <li v-for="item in q.attr">
                                                <div :class="['label']">{{ item.alias }}</div>
                                                <template v-if="item.type == 'ltext'">
                                                    <textarea v-if="item.editable" v-model="item.content" :class="['input', 'long']" rows='5'></textarea>
                                                    <textarea v-else disabled v-model="item.content" :class="['input', 'long']" rows='5'></textarea>
                                                </template>
                                                <template v-else-if="item.type == 'number'">
                                                    <input v-if="item.editable" v-model="item.content" :class="['input']" type="number" />
                                                    <input v-else disabled v-model="item.content" :class="['input']" type="number" />
                                                </template>
                                                <template v-else-if="item.type == 'file'">
                                                    <label :class="['fileuploader']">
                                                        <input type="file" :id="'q' + q.lid + '-' + (parseInt(p.lid) + 1).toString()" @change="q_file_change" required/>
                                                    </label>
                                                    {{ item.content }}
                                                </template>
                                            </li>
                                            <li>
                                                <button v-if="p.question_modifier_available" :class="['operator', 'negative', 'indent-3']" @click="remove_question(contest.period.indexOf(p), p.question.indexOf(q))"><span>{{ '删除题目' + (parseInt(q.lid) + 1).toString() }}</span></button>
                                            </li>
                                        </template>
                                        <li>
                                            <button v-if="p.question_modifier_available" :class="['operator', 'indent-3']" @click="insert_new_question(contest.period.indexOf(p))"><span>添加题目</span></button>
                                        </li>
                                        <li>
                                            <button v-if='contest.period_modifier_available' :class="['operator', 'negative', 'indent-3']" @click='remove_period(contest.period.indexOf(p))'><span>{{ '删除阶段 ' + get_p_name(contest.period.indexOf(p)) }}</span></button>
                                        </li>
                                    </ul>
                                    <button :class="['operator', 'indent-3']" v-if="contest.period_modifier_available" @click="insert_new_period"><span>添加阶段</span></button>
                                    <button :class="['operator', 'indent-3']" v-else disabled><span>添加阶段</span></button>
                                </article>
                            </div>
                            <div :class="['s-u-resp']">
                                <button @click="save" :class="['response-button']">暂存修改</button>
                                <button @click="publish" :class="['response-button']">保存并发布</button>
                            </div>
                    </template>
                </template>
                <template v-else></template>
            </template>
            <template v-else>
            </template>
        </div>
    </body>
    <script src="../js/uni_c.js"></script>
    <script src="../js/header_c.js"></script>
    <script src="../js/cdetail_c.js"></script>
</html>
<!-- template -->
