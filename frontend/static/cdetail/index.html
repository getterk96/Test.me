<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Test.Me</title>
        <script src="https://unpkg.com/vue"></script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script src="https://unpkg.com/current-device/umd/current-device.min.js"></script>
        <script src="../js/uni.js"></script>
        <link type="text/css" rel="stylesheet" href="../css/uni.css" />
        <link type="text/css" rel="stylesheet" href="../css/cdetail.css" />
    </head>
    <body>
        <div id="header">
            <div id="header-content">
                <div id="header-greeting">{{ greeting }}</div>
                <div id="header-title">{{ title }}</div>
                <nav><ul>
                    <li v-for='link in link_list'>
                        <a :href='link.link' @click='link.action'>{{ link.alias }}</a>
                    </li>
                </ul></nav>
            </div>
        </div>
<<<<<<< HEAD:test_me_view/dist/static/cdetail/index.html
        <nav id="side-nav">
            <ul>
                <li v-for="item in list">
                    <label :class="['choice', item == choice ? 'chosen' : 'unchosen']" @click='select(item)'>{{ item }}</label>
                </li>
            </ul>
        </nav>
        <div id="body">
            <template v-if="!is_guest">
                <template v-if="is_organizer">
                    <template v-if="page == '比赛信息'">
                        <div :class="['session']">
                            <button :class="['s-title', show_basic_info ? '' :  'collapse']" @click="switch_basic_info"><span :class="['title']">比赛基本信息</span></button>
                            <article :class="['s-body']" v-if="show_basic_info">
                                <ul :class="['form']">
                                    <li v-for='item in contest.attr'>
                                        <div :class="['label']">{{ item.alias }}</div>
                                        <template v-if="item.type == 'text'">
                                            <input v-if="item.editable" v-model="item.content" :class="['input', 'long']" />
                                            <input v-else disabled v-model="item.content" :class="['input', 'long']" />
                                        </template>
                                        <template v-else-if="item.type == 'ltext'">
                                            <textarea v-if="item.editable" v-model="item.content" :class="['input', 'long']" rows='5'></textarea>
                                            <textarea v-else disabled v-model="item.content" :class="['input', 'long']" rows='5'></textarea>
=======
        <div class='contentbox' id='contest-manager'>
            <div class='content' :class="['content-body']">
                <template v-if="isorganizer">
                    <template v-if="page === 1">
                    </template>
                    <template v-else-if="page === 2">
                        <template v-if="playeronbatch">
                            <div :class="['tableconsole']">
                                <div :class="['tableselect']">
                                    <button @click="set_all_player_status(true)">全选</button>
                                    <button @click="set_all_player_status(false)">全不选</button>
                                </div>
                                <div :class="['tableaction']">
                                    <button v-if="before_all_period && in_contest" @click="batch_manage(1)">通过审核</button>
                                    <button v-if="!in_period && in_contest && after_signup">晋级</button>
                                    <button v-else-if="!in_contest && after_signup" @click="batch_manage(2)">加入获奖名单</button>
                                    <button v-if="in_contest">取消资格</button>
                                </div>
                            </div>
                            <table>
                                <tr>
                                    <th v-for="header in playerlistheader" @click="change_sort_key(header.name)">{{ header.alias }}</th>
                                    <th>&nbsp;</th>
                                </tr>
                                <tr v-for="player in playerlist" :class="[player.chosen ? 'data-chosen' : 'data-unchosen']">
                                    <td v-for="value in player.info" :id="'player' + player.lid" @click="change_player_chosen_status(player.lid)">{{ value }}</td>
                                    <td @click="single_player_process(player.lid)">单独处理</td>
                                </tr>
                            </table>
                        </template>
                        <template v-else>
                            <div :class="['tableconsole']">
                                <button @click="batch_player_process">返回概览</button>
                                <button @click="prev_player">上一个</button>
                                <button @click="succ_player">下一个</button>
                            </div>
                            <div>
                                <div :class="['avatar']"><img :src="single_player.avatar_url" /></div>
                                <div :class="['playerinfo']">
                                    <ul>
                                        <li v-for="item in single_player.text_info"><span :class="['info-head']">{{ item.name }}</span>{{ item.content }}</li>
                                        <li><a :href="single_player.attachment_url">报名附件</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <button v-if="before_all_period && in_contest">通过审核</button>
                                    <button v-if="!in_period && in_contest && after_signup">晋级</button>
                                    <button v-else-if="!in_contest && after_signup">加入获奖名单</button>
                                    <button v-if="in_contest">取消资格</button>
                                </div>
                            </div>
                        </template>
                    </template>
                    <template v-else-if="page === 3">
                        <button :class="['session']" disabled><span>成绩录入说明</span></button>
                        <div>{{ record_instruction }}</div>
                        <label :class="['fileuploader']" id="rankupload">
                            <input type="file" @change="rank_file_change"/>
                        </label>
                        <div id="rank_filename">{{ rank_filename }}</div>
                    </template>
                    <template v-else>
                        <button :class="['session']" @click="change_basic_info"><span class="title">基本信息</span><span v-if="show_contest_basic_info" >[-]</span><span v-else>[+]</span></button>
                        <ul class="form" v-show="show_contest_basic_info">
                            <li>
                                <div :class="['label']">比赛名称</div>
                                <input :class="['input']" v-if="contest.name.editable" v-model="contest.name.content" />
                                <input :class="['input']" v-else disabled v-model="contest.name.content" title="现在该项不可编辑" />
                            </li>
                            <li>
                                <div :class="['label']">比赛简介</div>
                                <textarea :class="['input']" v-if="contest.description.editable" v-model="contest.description.content" rows='3'>{{ contest.description.content }}</textarea>
                                <textarea :class="['input']" v-else v-model="contest.description.content" rows='3' title="现在该项不可编辑">{{ contest.description.content }}</textarea>
                            </li>
                            <li>
                                <div :class="['label']">报名时间</div>
                                <template v-if="contest.time.editable">
                                    <div>
                                        <input :class="['input', 'short']" v-model="contest.time.content.sy" />年
                                        <input :class="['input', 'short']" v-model="contest.time.content.sm" />月
                                        <input :class="['input', 'short']" v-model="contest.time.content.sd" />日
                                        <input :class="['input', 'short']" v-model="contest.time.content.sh" />时
                                        <input :class="['input', 'short']" v-model="contest.time.content.sx" />分
                                        -
                                        <input :class="['input', 'short']" v-model="contest.time.content.ey" />年
                                        <input :class="['input', 'short']" v-model="contest.time.content.em" />月
                                        <input :class="['input', 'short']" v-model="contest.time.content.ed" />日
                                        <input :class="['input', 'short']" v-model="contest.time.content.eh" />时
                                        <input :class="['input', 'short']" v-model="contest.time.content.ex" />分
                                    </div>
                                </template>
                                <template v-else>
                                    <div title="现在该项不可编辑">
                                        <input :class="['input', 'short']" v-model="contest.time.content.sy" disabled />年
                                        <input :class="['input', 'short']" v-model="contest.time.content.sm" disabled />月
                                        <input :class="['input', 'short']" v-model="contest.time.content.sd" disabled />日
                                        <input :class="['input', 'short']" v-model="contest.time.content.sh" disabled />时
                                        <input :class="['input', 'short']" v-model="contest.time.content.sx" disabled />分
                                        -
                                        <input :class="['input', 'short']" v-model="contest.time.content.ey" disabled />年
                                        <input :class="['input', 'short']" v-model="contest.time.content.em" disabled />月
                                        <input :class="['input', 'short']" v-model="contest.time.content.ed" disabled />日
                                        <input :class="['input', 'short']" v-model="contest.time.content.eh" disabled />时
                                        <input :class="['input', 'short']" v-model="contest.time.content.ex" disabled />分
                                    </div>
                                </template>
                            </li>
                            <li>
                                <div :class="['label']">可报名人数</div>
                                <input v-if="contest.slots.editable" :class="['input']" v-model="contest.slots.content" />
                                <input v-else diabled :class="['input']" v-model="contest.slots.content" />
                            </li>
                            <li>
                                <div :class="['label']">已审核</div>
                                <progress :max="contest.slots.content" :value="contest.slots_filled" class="progressbar"></progress>
                                <span>{{ contest.slots_filled + '/' + contest.slots.content }}</span>
                            </li>
                            <li>
                                <div :class="['label']">比赛附件</div>
                                <label :class="['fileuploader']">
                                    <input type="file" @change="contest_attachment_change"  v-if="contest.attachment.editable" />
                                    <input type="file" @change="contest_attachment_change" v-else disabled title="现在该项不可编辑" />
                                </label>
                                {{ contest.attachment.filename }}
                            </li>
                        </ul>
                        <button :class="['session']" @click="change_period_info"><span class="title">阶段信息</span><span v-if="show_period_info" >[-]</span><span v-else>[+]</span></button>
                        <div>
                            <button @click="add_period" :class="['button', 'font-color-blue', 'float-right']" v-if="!contest.period_lock">+添加阶段</button>
                            <button @click="add_period" :class="['button', 'font-color-blue', 'float-right']" v-else disabled>+添加阶段</button>
                        </div>
                        <ul v-show="show_period_info">
                            <li v-for="item in contest.period">
                                <ul class="form">
                                    <li>
                                        <div :class="['label']">阶段名称</div>
                                        <input :class="['input']" v-if="item.name.editable" v-model="item.name.content" />
                                        <input :class="['input']" v-else disabled v-model="item.name.content" title="现在该项不可编辑" />
                                    </li>
                                    <li>
                                        <div :class="['label']">阶段简介</div>
                                        <textarea :class="['input']" v-if="item.description.editable" v-model="item.description.content" rows='3'>{{ item.description.content }}</textarea>
                                        <textarea :class="['input']" v-else v-model="item.description.content" rows='3' title="现在该项不可编辑">{{ item.description.content }}</textarea>
                                    </li>
                                    <li>
                                        <div :class="['label']">比赛时间</div>
                                        <template v-if="item.time.editable">
                                            <div>
                                                <input :class="['input', 'short']" v-model="item.time.content.sy" />年
                                                <input :class="['input', 'short']" v-model="item.time.content.sm" />月
                                                <input :class="['input', 'short']" v-model="item.time.content.sd" />日
                                                <input :class="['input', 'short']" v-model="item.time.content.sh" />时
                                                <input :class="['input', 'short']" v-model="item.time.content.sx" />分
                                                -
                                                <input :class="['input', 'short']" v-model="item.time.content.ey" />年
                                                <input :class="['input', 'short']" v-model="item.time.content.em" />月
                                                <input :class="['input', 'short']" v-model="item.time.content.ed" />日
                                                <input :class="['input', 'short']" v-model="item.time.content.eh" />时
                                                <input :class="['input', 'short']" v-model="item.time.content.ex" />分
                                            </div>
>>>>>>> m_lib/dev:frontend/static/cdetail/index.html
                                        </template>
                                        <template v-else-if="item.type == 'datetime'">
                                            <div v-if="item.editable">
                                                <input :class="['input', 'mid']" type="date" v-model="item.content.sd" />
                                                <input  v-model="item.content.sh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                <input  v-model="item.content.sm" :class="['input', 'short']" type="number" min="0" max="59" />-
                                                <input :class="['input', 'mid']" type="date" v-model="item.content.ed" />
                                                <input  v-model="item.content.eh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                <input  v-model="item.content.em" :class="['input', 'short']" type="number" min="0" max="59"/>
                                            </div>
                                            <div v-else>
                                                <input disabled :class="['input', 'mid']" type="date" v-model="item.content.sd" />
                                                <input disabled  v-model="item.content.sh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                <input disabled  v-model="item.content.sm" :class="['input', 'short']" type="number" min="0" max="59" />-
                                                <input disabled :class="['input', 'mid']" type="date" v-model="item.content.ed" />
                                                <input disabled  v-model="item.content.eh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                <input disabled  v-model="item.content.em" :class="['input', 'short']" type="number" min="0" max="59"/>
                                            </div>
                                        </template>
                                        <template v-else-if="item.type == 'number'">
                                            <input v-if="item.editable" v-model="item.content" :class="['input']" type="number" />
                                            <input v-else disabled v-model="item.content" :class="['input']" type="number" />
                                        </template>
                                        <template v-else-if="item.type == 'progress'">
                                            <progress :max="contest.getAttr(item.content.base)" :value="item.content.value" :class="['progressbar']"></progress>
                                            <span>{{ item.content.value + "/" + contest.getAttr(item.content.base) }}</span>
                                        </template>
                                        <template v-else-if="item.type == 'file'">
                                            <label :class="['fileuploader']">
                                                <input type="file" @change="c_file_change" required/>
                                            </label>
                                            {{ item.content }}
                                        </template>
                                    </li>
                                </ul>
                            </article>
                        </div>
                            <div :class="['session']">
                                <button :class="['s-title', show_period_info ? '' : 'collapse']" @click="switch_period_info"><span :class="['title']">阶段信息</span></button>
                                <article :class="['s-body']" v-if="show_period_info">
                                    <ul :class="['form']" v-for="p in contest.period">
                                        <li v-for='item in p.attr'>
                                            <div :class="['label']">{{ item.alias }}</div>
                                            <template v-if="item.type == 'text'">
                                                <input v-if="item.editable" v-model="item.content" :class="['input', 'long']" />
                                                <input v-else disabled v-model="item.content" :class="['input', 'long']" />
                                            </template>
                                            <template v-else-if="item.type == 'ltext'">
                                                <textarea v-if="item.editable" v-model="item.content" :class="['input', 'long']" rows='5'></textarea>
                                                <textarea v-else disabled v-model="item.content" :class="['input', 'long']" rows='5'></textarea>
                                            </template>
                                            <template v-else-if="item.type == 'datetime'">
                                                <div v-if="item.editable">
                                                    <input :class="['input', 'mid']" type="date" v-model="item.content.sd" />
                                                    <input  v-model="item.content.sh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                    <input  v-model="item.content.sm" :class="['input', 'short']" type="number" min="0" max="59" />-
                                                    <input :class="['input', 'mid']" type="date" v-model="item.content.ed" />
                                                    <input  v-model="item.content.eh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                    <input  v-model="item.content.em" :class="['input', 'short']" type="number" min="0" max="59"/>
                                                </div>
                                                <div v-else>
                                                    <input disabled :class="['input', 'mid']" type="date" v-model="item.content.sd" />
                                                    <input disabled  v-model="item.content.sh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                    <input disabled  v-model="item.content.sm" :class="['input', 'short']" type="number" min="0" max="59" />-
                                                    <input disabled :class="['input', 'mid']" type="date" v-model="item.content.ed" />
                                                    <input disabled  v-model="item.content.eh" :class="['input', 'short']" type="number" min="0" max="23" />:
                                                    <input disabled  v-model="item.content.em" :class="['input', 'short']" type="number" min="0" max="59"/>
                                                </div>
                                            </template>
                                            <template v-else-if="item.type == 'number'">
                                                <input v-if="item.editable" v-model="item.content" :class="['input']" type="number" />
                                                <input v-else disabled v-model="item.content" :class="['input']" type="number" />
                                            </template>
                                            <template v-else-if="item.type == 'progress'">
                                                <progress :max="contest.getAttr(item.content.base)" :value="item.content.value" :class="['progressbar']"></progress>
                                                <span>{{ item.content.value + "/" + contest.getAttr(item.content.base) }}</span>
                                            </template>
                                            <template v-else-if="item.type == 'file'">
                                                <label :class="['fileuploader']">
                                                    <input type="file" :id="'p' + p.lid" @change="p_file_change" required/>
                                                </label>
                                                {{ item.content }}
                                            </template>
                                        </li>
                                        <template v-for="q in p.question">
                                            <li>
                                                <div :class="['label', 'bold']">{{ '题目' + (parseInt(q.lid) + 1).toString() }}</div>
                                            </li>
                                            <li v-for="item in q.attr">
                                                <div :class="['label']">{{ item.alias }}</div>
                                                <template v-if="item.type == 'ltext'">
                                                    <textarea v-if="item.editable" v-model="item.content" :class="['input', 'long']" rows='5'></textarea>
                                                    <textarea v-else disabled v-model="item.content" :class="['input', 'long']" rows='5'></textarea>
                                                </template>
                                                <template v-else-if="item.type == 'number'">
                                                    <input v-if="item.editable" v-model="item.content" :class="['input']" type="number" />
                                                    <input v-else disabled v-model="item.content" :class="['input']" type="number" />
                                                </template>
                                                <template v-else-if="item.type == 'file'">
                                                    <label :class="['fileuploader']">
                                                        <input type="file" :id="'q' + q.lid + '-' + (parseInt(p.lid) + 1).toString()" @change="q_file_change" required/>
                                                    </label>
                                                    {{ item.content }}
                                                </template>
                                            </li>
                                            <li>
                                                <button v-if="p.question_modifier_available" :class="['operator', 'negative', 'indent-3']" @click="remove_question(contest.period.indexOf(p), p.question.indexOf(q))"><span>{{ '删除题目' + (parseInt(q.lid) + 1).toString() }}</span></button>
                                            </li>
                                        </template>
                                        <li>
                                            <button v-if="p.question_modifier_available" :class="['operator', 'indent-3']" @click="insert_new_question(contest.period.indexOf(p))"><span>添加题目</span></button>
                                        </li>
                                        <li>
                                            <button v-if='contest.period_modifier_available' :class="['operator', 'negative', 'indent-3']" @click='remove_period(contest.period.indexOf(p))'><span>{{ '删除阶段 ' + get_p_name(contest.period.indexOf(p)) }}</span></button>
                                        </li>
                                    </ul>
                                    <button :class="['operator', 'indent-3']" v-if="contest.period_modifier_available" @click="insert_new_period"><span>添加阶段</span></button>
                                    <button :class="['operator', 'indent-3']" v-else disabled><span>添加阶段</span></button>
                                </article>
                            </div>
                            <div :class="['s-u-resp']">
                                <button @click="save" :class="['response-button']">暂存修改</button>
                                <button @click="publish" :class="['response-button']">保存并发布</button>
                            </div>
                    </template>
                </template>
                <template v-else></template>
            </template>
            <template v-else>
            </template>
        </div>
    </body>
    <script src="../js/uni_c.js"></script>
    <script src="../js/header_c.js"></script>
    <script src="../js/cdetail_c.js"></script>
</html>
<!-- template -->
