<!-- Created by Ica Riluci-->
<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8' />
        <title>比赛管理</title>
        <script src="https://unpkg.com/vue"></script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <link type="text/css" rel="stylesheet" href="../css/common.css" />
        <link type="text/css" rel="stylesheet" href="../css/cdetail_main.css" />
        <script src="../js/common.js"></script>
    </head>
    <body>
        <div id="header" :class="[color]" v-show="showheader">
            <div id="nav-header" :class="[display_nav ? 'nav-displayed' : 'nav-hidden']" v-show="shownav">{{ nav_header }}</div>
            <nav id='nav-body' :class="[display_nav ? 'nav-displayed' : 'nav-hidden', color_nav]" v-show="shownav">
                <ul>
                    <li v-for='item in nav_list'>
                        <a :href='item.link' @click='item.op'>{{ item.name }}</a>
                    </li>
                </ul>
            </nav>
            <button id="side-nav-c" v-show="shownav" :class="[display_nav ? 'nav-displayed-c' : 'nav-hidden-c']" @click="change_nav_status">&nbsp;&nbsp;{{ nav_c }}</button>
            <nav id='personal-nav' v-show='showpersonal'>
                <ul>
                    <li v-for='link in link_list'>
                        <a :href='link.link' @click='link.action'>{{ link.alias }}</a>
                    </li>
                    <li id="title-label"><a>Test.Me</a></li>
                </ul>
            </nav>
            <div id='search-box' v-show='showsearchbox' :class="[showsearchinput ? 'search-box-long' : 'search-box-short']">
                <button :class="[showsearchinput ? 'cancel-search' : 'search']" @click='change_search_status'></button>
                <input v-show='showsearchinput'/>
            </div>
        </div>
        <div class='contentbox' id='contest-manager'>
            <div class='content' :class="['content-body']">
                <template v-if="isorganizer">
                    <template v-if="page === 1">
                    </template>
                    <template v-else-if="page === 2">
                        <template v-if="playeronbatch">
                            <div :class="['tableconsole']">
                                <div :class="['tableselect']">
                                    <button @click="set_all_player_status(true)">全选</button>
                                    <button @click="set_all_player_status(false)">全不选</button>
                                </div>
                                <div :class="['tableaction']">
                                    <button v-if="before_all_period && in_contest" @click="batch_manage(1)">通过审核</button>
                                    <button v-if="!in_period && in_contest && after_signup">晋级</button>
                                    <button v-else-if="!in_contest && after_signup" @click="batch_manage(2)">加入获奖名单</button>
                                    <button v-if="in_contest">取消资格</button>
                                </div>
                            </div>
                            <table>
                                <tr>
                                    <th v-for="header in playerlistheader" @click="change_sort_key(header.name)">{{ header.alias }}</th>
                                    <th>&nbsp;</th>
                                </tr>
                                <tr v-for="player in playerlist" :class="[player.chosen ? 'data-chosen' : 'data-unchosen']">
                                    <td v-for="value in player.info" :id="'player' + player.lid" @click="change_player_chosen_status(player.lid)">{{ value }}</td>
                                    <td @click="single_player_process(player.lid)">单独处理</td>
                                </tr>
                            </table>
                        </template>
                        <template v-else>
                            <div :class="['tableconsole']">
                                <button @click="batch_player_process">返回概览</button>
                                <button @click="prev_player">上一个</button>
                                <button @click="succ_player">下一个</button>
                            </div>
                            <div>
                                <div :class="['avatar']"><img :src="single_player.avatar_url" /></div>
                                <div :class="['playerinfo']">
                                    <ul>
                                        <li v-for="item in single_player.text_info"><span :class="['info-head']">{{ item.name }}</span>{{ item.content }}</li>
                                        <li><a :href="single_player.attachment_url">报名附件</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <button v-if="before_all_period && in_contest">通过审核</button>
                                    <button v-if="!in_period && in_contest && after_signup">晋级</button>
                                    <button v-else-if="!in_contest && after_signup">加入获奖名单</button>
                                    <button v-if="in_contest">取消资格</button>
                                </div>
                            </div>
                        </template>
                    </template>
                    <template v-else-if="page === 3">
                        <button :class="['session']" disabled><span>成绩录入说明</span></button>
                        <div>{{ record_instruction }}</div>
                        <label :class="['fileuploader']" id="rankupload">
                            <input type="file" @change="rank_file_change"/>
                        </label>
                        <div id="rank_filename">{{ rank_filename }}</div>
                    </template>
                    <template v-else>
                        <button :class="['session']" @click="change_basic_info"><span class="title">基本信息</span><span v-if="show_contest_basic_info" >[-]</span><span v-else>[+]</span></button>
                        <ul class="form" v-show="show_contest_basic_info">
                            <li>
                                <div :class="['label']">比赛名称</div>
                                <input :class="['input']" v-if="contest.name.editable" v-model="contest.name.content" />
                                <input :class="['input']" v-else disabled v-model="contest.name.content" title="现在该项不可编辑" />
                            </li>
                            <li>
                                <div :class="['label']">比赛简介</div>
                                <textarea :class="['input']" v-if="contest.description.editable" v-model="contest.description.content" rows='3'>{{ contest.description.content }}</textarea>
                                <textarea :class="['input']" v-else v-model="contest.description.content" rows='3' title="现在该项不可编辑">{{ contest.description.content }}</textarea>
                            </li>
                            <li>
                                <div :class="['label']">报名时间</div>
                                <template v-if="contest.time.editable">
                                    <div>
                                        <input :class="['input', 'short']" v-model="contest.time.content.sy" />年
                                        <input :class="['input', 'short']" v-model="contest.time.content.sm" />月
                                        <input :class="['input', 'short']" v-model="contest.time.content.sd" />日
                                        <input :class="['input', 'short']" v-model="contest.time.content.sh" />时
                                        <input :class="['input', 'short']" v-model="contest.time.content.sx" />分
                                        -
                                        <input :class="['input', 'short']" v-model="contest.time.content.ey" />年
                                        <input :class="['input', 'short']" v-model="contest.time.content.em" />月
                                        <input :class="['input', 'short']" v-model="contest.time.content.ed" />日
                                        <input :class="['input', 'short']" v-model="contest.time.content.eh" />时
                                        <input :class="['input', 'short']" v-model="contest.time.content.ex" />分
                                    </div>
                                </template>
                                <template v-else>
                                    <div title="现在该项不可编辑">
                                        <input :class="['input', 'short']" v-model="contest.time.content.sy" disabled />年
                                        <input :class="['input', 'short']" v-model="contest.time.content.sm" disabled />月
                                        <input :class="['input', 'short']" v-model="contest.time.content.sd" disabled />日
                                        <input :class="['input', 'short']" v-model="contest.time.content.sh" disabled />时
                                        <input :class="['input', 'short']" v-model="contest.time.content.sx" disabled />分
                                        -
                                        <input :class="['input', 'short']" v-model="contest.time.content.ey" disabled />年
                                        <input :class="['input', 'short']" v-model="contest.time.content.em" disabled />月
                                        <input :class="['input', 'short']" v-model="contest.time.content.ed" disabled />日
                                        <input :class="['input', 'short']" v-model="contest.time.content.eh" disabled />时
                                        <input :class="['input', 'short']" v-model="contest.time.content.ex" disabled />分
                                    </div>
                                </template>
                            </li>
                            <li>
                                <div :class="['label']">可报名人数</div>
                                <input v-if="contest.slots.editable" :class="['input']" v-model="contest.slots.content" />
                                <input v-else diabled :class="['input']" v-model="contest.slots.content" />
                            </li>
                            <li>
                                <div :class="['label']">已审核</div>
                                <progress :max="contest.slots.content" :value="contest.slots_filled" class="progressbar"></progress>
                                <span>{{ contest.slots_filled + '/' + contest.slots.content }}</span>
                            </li>
                            <li>
                                <div :class="['label']">比赛附件</div>
                                <label :class="['fileuploader']">
                                    <input type="file" @change="contest_attachment_change"  v-if="contest.attachment.editable" />
                                    <input type="file" @change="contest_attachment_change" v-else disabled title="现在该项不可编辑" />
                                </label>
                                {{ contest.attachment.filename }}
                            </li>
                        </ul>
                        <button :class="['session']" @click="change_period_info"><span class="title">阶段信息</span><span v-if="show_period_info" >[-]</span><span v-else>[+]</span></button>
                        <div>
                            <button @click="add_period" :class="['button', 'font-color-blue', 'float-right']" v-if="!contest.period_lock">+添加阶段</button>
                            <button @click="add_period" :class="['button', 'font-color-blue', 'float-right']" v-else disabled>+添加阶段</button>
                        </div>
                        <ul v-show="show_period_info">
                            <li v-for="item in contest.period">
                                <ul class="form">
                                    <li>
                                        <div :class="['label']">阶段名称</div>
                                        <input :class="['input']" v-if="item.name.editable" v-model="item.name.content" />
                                        <input :class="['input']" v-else disabled v-model="item.name.content" title="现在该项不可编辑" />
                                    </li>
                                    <li>
                                        <div :class="['label']">阶段简介</div>
                                        <textarea :class="['input']" v-if="item.description.editable" v-model="item.description.content" rows='3'>{{ item.description.content }}</textarea>
                                        <textarea :class="['input']" v-else v-model="item.description.content" rows='3' title="现在该项不可编辑">{{ item.description.content }}</textarea>
                                    </li>
                                    <li>
                                        <div :class="['label']">比赛时间</div>
                                        <template v-if="item.time.editable">
                                            <div>
                                                <input :class="['input', 'short']" v-model="item.time.content.sy" />年
                                                <input :class="['input', 'short']" v-model="item.time.content.sm" />月
                                                <input :class="['input', 'short']" v-model="item.time.content.sd" />日
                                                <input :class="['input', 'short']" v-model="item.time.content.sh" />时
                                                <input :class="['input', 'short']" v-model="item.time.content.sx" />分
                                                -
                                                <input :class="['input', 'short']" v-model="item.time.content.ey" />年
                                                <input :class="['input', 'short']" v-model="item.time.content.em" />月
                                                <input :class="['input', 'short']" v-model="item.time.content.ed" />日
                                                <input :class="['input', 'short']" v-model="item.time.content.eh" />时
                                                <input :class="['input', 'short']" v-model="item.time.content.ex" />分
                                            </div>
                                        </template>
                                        <template v-else>
                                            <div title="现在该项不可编辑">
                                                <input :class="['input', 'short']" v-model="item.time.content.sy" disabled />年
                                                <input :class="['input', 'short']" v-model="item.time.content.sm" disabled />月
                                                <input :class="['input', 'short']" v-model="item.time.content.sd" disabled />日
                                                <input :class="['input', 'short']" v-model="item.time.content.sh" disabled />时
                                                <input :class="['input', 'short']" v-model="item.time.content.sx" disabled />分
                                                -
                                                <input :class="['input', 'short']" v-model="item.time.content.ey" disabled />年
                                                <input :class="['input', 'short']" v-model="item.time.content.em" disabled />月
                                                <input :class="['input', 'short']" v-model="item.time.content.ed" disabled />日
                                                <input :class="['input', 'short']" v-model="item.time.content.eh" disabled />时
                                                <input :class="['input', 'short']" v-model="item.time.content.ex" disabled />分
                                            </div>
                                        </template>
                                    </li>
                                    <li>
                                        <div :class="['label']">可参加人数</div>
                                        <input v-if="item.slots.editable" :class="['input']" v-model="item.slots.content" />
                                        <input v-else diabled :class="['input']" v-model="item.slots.content" title="现在该项不可编辑" />
                                    </li>
                                    <li>
                                        <div :class="['label']">已进入</div>
                                        <progress :max="item.slots.content" :value="item.slots_filled" class="progressbar"></progress>
                                        <span>{{ item.slots_filled + '/' + item.slots.content }}</span>
                                    </li>
                                    <li>
                                        <div :class="['label']">阶段附件</div>
                                        <label :class="['fileuploader']">
                                            <input :id="item.id" type="file" @change="item.attachment.change"  v-if="item.attachment.editable" />
                                            <input :id="item.id" type="file" @change="item.attachment.change" v-else disabled title="现在该项不可编辑" />
                                        </label>
                                        {{ item.attachment.filename }}
                                    </li>
                                </ul>
                            </li>
                        </ul>
                        <button :class="['confirm-button']" @click='submitcontestinfo'>保存修改</button>
                    </template>
                </template>
            </div>
        </div>
        <div id="dev-info">{{ info }}</div>
    </body>
    <script src="../js/common_control.js"></script>
    <script src="../js/cdetail_main_control.js"></script>
</html>
